paths:

  /labs/pick:
    access: anybody
    action:
      type: pick
      entity: lab

  /labs/view:
    access: anybody
    action:
      type: view
      entity: lab

  /individuals/make:
    access: anybody
    action:
      type: make
      entity: individual
#     query: |
#       /do(
#         $id := insert(individual := { code := $code, sex := $sex }),
#         { id := $id }
#       )
      fields:
      - column:
        - code
        - sex

  /individuals/pick:
    access: anybody
    action:
      type: pick
      entity: individual
      search: code~$search
      fields:
      - code
      - identity.givenname
      - identity.surname

  /individuals/view:
    access: anybody
    action:
      type: view
      entity: individual
      fields:
      - code
      - identity.givenname
      - identity.surname
      - sex

  /individuals/wizard:
    access: anybody
    action:
      type: wizard
      title: Individuals
      path:
      - /individuals/pick:
      - /individuals/make:

  /individuals/edit:
    access: anybody
    action:
      type: wizard
      title: Individuals Edit
      path:
      - edit-individual:
        - /individuals/view:
        - drop-individual:

      states:
        individual:
          x:
            title: X
            expression: id() = 'A11Z1814'

      actions:
        drop-individual:
          type: drop
          entity: individual[x]
        edit-individual:
          type: edit
          entity: individual
          fields:
          - code
          - sex
          query: |
            /do(
              $id := update(individual := { code := $code, sex := $sex }),
              { id := $id }
            )

  /:
    access: anybody
    action:
      type: wizard
      path:
      - /individuals/wizard:
        - drop-individual:
        - /individuals/view?individual=individual[super]:
        - /individuals/edit:
      - /labs/pick:
        - /labs/view:
      actions:
        drop-individual:
          type: drop
          entity: individual
      states:
        individual:
          super:
            title: Super
            expression: id() = 'A11Z1814'
