paths:

  /labs/pick:
    access: anybody
    action:
      type: pick
      entity: lab

  /labs/view:
    access: anybody
    action:
      type: view
      entity: lab

  /individuals/make:
    access: anybody
    action:
      type: make
      entity: individual
#     query: |
#       /do(
#         $id := insert(individual := { code := $code, sex := $sex }),
#         { id := $id }
#       )
      fields:
      - column:
        - code
        - sex

  /individuals/view:
    access: anybody
    action:
      type: view
      entity: individual
      fields:
      - code
      - identity.givenname
      - identity.surname
      - sex

  /individuals/pick-make:
    access: anybody
    action:
      type: wizard
      title: Individuals
      path:
      - pick-individual:
      - make-individual:
        - replace: ../pick-individual
      actions:
        make-individual: /individuals/make
        view-individual: /individuals/view
        view-lab: /labs/view
        pick-lab: /labs/pick
        pick-individual:
          type: pick
          entity: individual
          search: code~$search
          fields:
          - code
          - identity.givenname
          - identity.surname


  /individuals/edit:
    access: anybody
    action:
      type: wizard
      title: Individuals Edit
      path:
      - edit-individual:
        - view-individual:
        - drop-individual:

      actions:
        view-individual: /individuals/view
        drop-individual:
          type: drop
          entity: individual[x]
        edit-individual:
          type: edit
          entity: individual
          fields:
          - code
          - sex
          query: |
            /do(
              $id := update(individual := { code := $code, sex := $sex }),
              { id := $id }
            )

      states:
        individual:
          x:
            title: Super
            expression: id() = 'A11Z1814'

  /:
    access: anybody
    action:
      type: wizard
      path:
      - pick-make-individual:
        - drop-individual:
        - view-individual:
        - edit-individual:
      - pick-lab:
        - view-lab:
      actions:
        pick-lab: /labs/pick
        view-lab: /labs/view
        pick-make-individual: /individuals/pick-make
        view-individual: /individuals/view?individual=individual[super]
        edit-individual: /individuals/edit
        drop-individual:
          type: drop
          entity: individual
      states:
        individual:
          super:
            title: Super
            expression: id() = 'A11Z1814'
