include:
- base.yaml
paths:

  /individuals/make:
    access: nobody
    action:
      type: make
      entity: individual
#     query: |
#       /do(
#         $id := insert(individual := { code := $code, sex := $sex }),
#         { id := $id }
#       )
      fields:
      - column:
        - code
        - sex

  /individuals/view:
    access: anybody
    action:
      type: view
      entity: individual
      fields:
      - code
      - identity.givenname
      - identity.surname
      - sex


  /individuals/edit:
    access: anybody
    action:
      type: wizard
      title: Individuals Edit
      path:
      - edit-individual:
        - view-individual:
        - drop-individual:

      actions:
        view-individual: /individuals/view
        drop-individual:
          type: drop
          title: Drop
          entity: individual[x]
        edit-individual:
          type: edit
          title: Edit
          entity: individual
          fields:
          - code
          - sex
          query: |
            /do(
              $id := update(individual := { code := $code, sex := $sex }),
              { id := $id }
            )

      states:
        individual:
          x:
            title: Super
            expression: id() = 'A11Z1814'

  /:
    access: anybody
    action:
      type: wizard
      path:
      - pick-lab:
        - view-lab:
        - edit-lab:
        - drop-lab:
        - make-lab:
          - replace: ../../pick-lab
      actions:
        pick-lab: /labs/pick
        view-lab: /labs/view
        make-lab:
          type: make
          entity: lab
        edit-lab: /labs/edit
        drop-lab:
          type: drop
          entity: lab
        pick-make-individual: /individuals/pick-make
        view-individual: /individuals/view?individual=individual[super]
        edit-individual: /individuals/edit
        drop-individual:
          type: drop
          title: Drop
          entity: individual

      states:
        individual:
          super:
            title: Super
            expression: id() = 'A11Z1814'
