#
# This file contains expected test output data generated by PBBT.
#
---
suite: rex.forms
tests:
- sh: pip install --quiet --editable ./demo
  stdout: ''
- sh: rex dropdb --quiet rex.forms_demo
  stdout: ''
- sh: rex deploy --quiet rex.forms_demo
  stdout: ''
- forms: test/forms/*.json
  validations:
  - {test/forms/audio.json: VALIDATED}
  - {test/forms/audio_element.json: VALIDATED}
  - {test/forms/audio_enumeration.json: VALIDATED}
  - {test/forms/bad_audio.json: 'ValidationError: {''text'': {''en'': ''How do you
      feel today?''}, ''audio'': {''en'': ''http://example.com/howfeel.mp3''}, ''fieldId'':
      ''q_fake''} is not valid under any of the given schemas'}
  - {test/forms/bad_instrument.json: 'ValidationError: u''version'' is a required
      property'}
  - {test/forms/broken_instrument.json: 'ValidationError: Instrument Definitions must
      be mapped objects.'}
  - {test/forms/enumeration.json: VALIDATED}
  - {test/forms/event.json: VALIDATED}
  - {test/forms/extra_element_options.json: 'ValidationError: "header" Element cannot
      have options: fieldId'}
  - {test/forms/extra_field.json: 'ValidationError: There are fields that are not
      in the Instrument: q_doesntexist'}
  - {test/forms/garbage.json: 'ValidationError: Form Configurations must be mapped
      objects.'}
  - {test/forms/instrument_not_an_object.json: 'ValidationError: Instrument Definitions
      must be mapped objects.'}
  - {test/forms/missing_audio_localization.json: 'ValidationError: Element audio missing
      localization for en'}
  - {test/forms/missing_defaultlocalization.json: 'ValidationError: u''defaultLocalization''
      is a required property'}
  - {test/forms/missing_element_options.json: 'ValidationError: "header" Element missing
      required options: text'}
  - {test/forms/missing_enumeration_help_localization.json: 'ValidationError: Enumeration
      help missing localization for en'}
  - {test/forms/missing_enumeration_localization.json: 'ValidationError: Enumeration
      text missing localization for en'}
  - {test/forms/missing_field.json: 'ValidationError: There are fields which have
      not be used: q_foobar'}
  - {test/forms/missing_field_error_localization.json: 'ValidationError: Element error
      missing localization for en'}
  - {test/forms/missing_field_help_localization.json: 'ValidationError: Element help
      missing localization for en'}
  - {test/forms/missing_field_localization.json: 'ValidationError: Element text missing
      localization for en'}
  - {test/forms/missing_instrument.json: 'ValidationError: u''instrument'' is a required
      property'}
  - {test/forms/missing_page_elements.json: 'ValidationError: u''elements'' is a required
      property'}
  - {test/forms/missing_page_id.json: 'ValidationError: u''id'' is a required property'}
  - {test/forms/missing_pages.json: 'ValidationError: u''pages'' is a required property'}
  - {test/forms/missing_title_localization.json: 'ValidationError: Form title missing
      localization for en'}
  - {test/forms/not_an_object.json: 'ValidationError: Form Configurations must be
      mapped objects.'}
  - {test/forms/repeat_field.json: 'ValidationError: Field "q_fake" is used by multiple
      questions'}
  - {test/forms/repeat_page.json: 'ValidationError: Page identifiers are used multiple
      times: page1'}
  - {test/forms/simplest.json: VALIDATED}
  - {test/forms/unprompted.json: VALIDATED}
  - {test/forms/widget.json: VALIDATED}
- suite: rex-forms-validate
  tests:
  - sh: rex forms-validate test/forms/simplest.json
    stdout: |+
      "test/forms/simplest.json" contains a valid Web Form Configuration.

  - sh: rex forms-validate test/forms/missing_pages.json
    stdout: |+
      FATAL ERROR: u'pages' is a required property

  - sh: rex forms-validate /tmp/does/not/actually/exist.json
    stdout: |+
      FATAL ERROR: Could not open "/tmp/does/not/actually/exist.json": [Errno 2] No such file or directory: '/tmp/does/not/actually/exist.json'

  - sh: rex forms-validate
    stdout: |+
      FATAL ERROR: missing argument <configuration>

- suite: rex-forms-retrieve
  tests:
  - sh: rex forms-retrieve simple survey rex.forms_demo
    stdout: |
      {"instrument": {"version": "1.1", "id": "urn:test-instrument"}, "defaultLocalization": "en", "pages": [{"elements": [{"type": "question", "options": {"text": {"en": "How do you feel today?"}, "fieldId": "q_fake"}}], "id": "page1"}]}
