{
    "$schema": "http://json-schema.org/draft-04/schema#",

    "id": "http://rexdb.com/form/0.4.0#",
    "title": "Form Configuration Definition",

    "definitions": {
        "localizedStringType": {
            "type": "object",

            "patternProperties": {
                "^[a-z]{2}(-[a-zA-Z]{2})?$": {
                    "type": "string"
                }
            },

            "minProperties": 1,

            "additionalProperties": false
        },

        "instrumentType": {
            "type": "object",

            "properties": {
                "id": {
                    "type": "string",
                    "format": "uri"
                },

                "version": {
                    "type": "string",
                    "pattern": "^[0-9]+\\.[0-9]+$"
                }
            },

            "required": [
                "id",
                "version"
            ],

            "additionalProperties": false
        },

        "expressionType": {
            "type": "string"
        },

        "widgetType": {
            "type": "object",

            "properties": {
                "type": {
                    "type": "string",
                    "minLength": 1
                },

                "options": {
                    "type": "object",
                    "minProperties": 1
                }
            },

            "required": [
                "type"
            ],

            "additionalProperties": false
        },

        "descriptorType": {
            "type": "object",

            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$"
                },

                "text": {
                    "$ref": "#/definitions/localizedStringType"
                },

                "help": {
                    "$ref": "#/definitions/localizedStringType"
                }
            },

            "required": [
                "id",
                "text"
            ],

            "additionalProperties": false
        },

        "descriptorListType": {
            "type": "array",

            "items": {
                "$ref": "#/definitions/descriptorType"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "targetListType": {
            "type": "array",

            "items": {
                "type": "string",
                "pattern": "^([a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9])(\\.([a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]))*$"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "eventType": {
            "type": "object",

            "properties": {
                "trigger": {
                    "$ref": "#/definitions/expressionType"
                },

                "action": {
                    "enum": [
                        "hide",
                        "disable",
                        "hideEnumeration",
                        "fail",
                        "calculate"
                    ]
                },

                "targets": {
                    "$ref": "#/definitions/targetListType"
                },

                "options": {
                    "type": "object",
                    "minProperties": 1
                }
            },

            "required": [
                "trigger",
                "action"
            ],

            "additionalProperties": false
        },

        "eventListType": {
            "type": "array",

            "items": {
                "$ref": "#/definitions/eventType"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "questionElementType": {
            "type": "object",

            "properties": {
                "fieldId": {
                    "type": "string",
                    "pattern": "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$"
                },

                "text": {
                    "$ref": "#/definitions/localizedStringType"
                },

                "help": {
                    "$ref": "#/definitions/localizedStringType"
                },

                "error": {
                    "$ref": "#/definitions/localizedStringType"
                },

                "widget": {
                    "$ref": "#/definitions/widgetType"
                },

                "enumerations": {
                    "$ref": "#/definitions/descriptorListType"
                },

                "questions": {
                    "$ref": "#/definitions/questionListType"
                },

                "rows": {
                    "$ref": "#/definitions/descriptorListType"
                },

                "events": {
                    "$ref": "#/definitions/eventListType"
                }
            },

            "required": [
                "fieldId"
            ],

            "additionalProperties": false
        },

        "questionListType": {
            "type": "array",

            "items": {
                "$ref": "#/definitions/questionElementType"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "textElementType": {
            "type": "object",

            "properties": {
                "text": {
                    "$ref": "#/definitions/localizedStringType"
                }
            },

            "required": [
                "text"
            ],

            "additionalProperties": false
        },

        "tagListType": {
            "type": "array",

            "items": {
                "type": "string",
                "pattern": "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "elementType": {
            "type": "object",

            "properties": {
                "type": {
                    "enum": [
                        "question",
                        "header",
                        "text",
                        "divider"
                    ]
                },

                "options": {
                    "anyOf": [
                        { "$ref": "#/definitions/questionElementType" },
                        { "$ref": "#/definitions/textElementType" }
                    ]
                },

                "tags": {
                    "$ref": "#/definitions/tagListType"
                }
            },

            "required": [
                "type"
            ],

            "additionalProperties": false
        },

        "elementListType": {
            "type": "array",

            "items": {
                "$ref": "#/definitions/elementType"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "pageType": {
            "type": "object",

            "properties": {
                "id": {
                    "type": "string",
                    "pattern": "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$"
                },

                "elements": {
                    "$ref": "#/definitions/elementListType"
                }
            },

            "required": [
                "id",
                "elements"
            ],

            "additionalProperties": false
        },

        "pageListType": {
            "type": "array",

            "items": {
                "$ref": "#/definitions/pageType"
            },

            "minItems": 1,

            "additionalItems": false
        },

        "unpromptedType": {
            "type": "object",

            "properties": {
                "action": {
                    "enum": [
                        "calculate"
                    ]
                },

                "options": {
                    "type": "object",
                    "minProperties": 1
                }
            },

            "minProperties": 1,

            "additionalProperties": false
        },

        "unpromptedCollectionType": {
            "type": "object",

            "patternProperties": {
                "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$": {
                    "$ref": "#/definitions/unpromptedType"
                }
            },

            "minProperties": 1,

            "additionalProperties": false
        },

        "parameterType": {
            "type": "object",

            "properties": {
                "type": {
                    "enum": [
                        "numeric",
                        "text",
                        "boolean"
                    ]
                }
            },

            "required": [
                "type"
            ],

            "additionalProperties": false
        },

        "parameterCollectionType": {
            "type": "object",

            "patternProperties": {
                "^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$": {
                    "$ref": "#/definitions/parameterType"
                }
            },

            "minProperties": 1,

            "additionalProperties": false
        }
    },

    "type": "object",

    "properties": {
        "instrument": {
            "$ref": "#/definitions/instrumentType"
        },

        "defaultLocalization": {
            "type": "string",
            "pattern": "^[a-z]{2}(-[a-zA-Z]{2})?$"
        },

        "title": {
            "$ref": "#/definitions/localizedStringType"
        },

        "tags": {
            "$ref": "#/definitions/tagListType"
        },

        "pages": {
            "$ref": "#/definitions/pageListType"
        },

        "unprompted": {
            "$ref": "#/definitions/unpromptedCollectionType"
        },

        "parameters": {
            "$ref": "#/definitions/parameterCollectionType"
        }
    },

    "required": [
        "instrument",
        "defaultLocalization",
        "pages"
    ],

    "additionalProperties": false
}

