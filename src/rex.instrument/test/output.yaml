#
# This file contains expected test output data generated by PBBT.
#
---
suite: rex.instrument
tests:
- sh: pip install -q -e ./demo/rex.instrument_demo
  stdout: ''
- instrumentversions: test/instruments/*.json
  validations:
  - {test/instruments/annotation.json: VALIDATED}
  - {test/instruments/annotation_bad.json: 'ValidationError: u''sure'' is not one
      of [u''required'', u''optional'', u''none'']'}
  - {test/instruments/annotation_required_mismatch.json: 'ValidationError: A field
      cannot both be required and allow annotations.'}
  - {test/instruments/bad_description.json: 'ValidationError: True is not of type
      u''string'''}
  - {test/instruments/bad_id.json: 'ValidationError: u''bad'' is not a u''uri'''}
  - {test/instruments/bad_question_id.json: 'ValidationError: u''Q--FAKE'' does not
      match u''^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$'''}
  - {test/instruments/bad_question_type.json: 'ValidationError: "foobar" is not a
      known field type.'}
  - {test/instruments/bad_version.json: 'ValidationError: u''bad'' does not match
      u''^[0-9]+\\.[0-9]+$'''}
  - {test/instruments/constraint_enumerations.json: VALIDATED}
  - {test/instruments/constraint_enumerations_missing.json: 'ValidationError: "enumeration"
      Field missing required options: enumerations'}
  - {test/instruments/constraint_enumerations_notallowed.json: 'ValidationError: "integer"
      Fields cannot have constraints: enumerations'}
  - {test/instruments/constraint_length.json: VALIDATED}
  - {test/instruments/constraint_length_notallowed.json: 'ValidationError: "integer"
      Fields cannot have constraints: length'}
  - {test/instruments/constraint_range.json: VALIDATED}
  - {test/instruments/constraint_range_bad.json: 'ValidationError: {u''range'': {u''min'':
      u''1''}, u''base'': u''integer''} is not valid under any of the given schemas'}
  - {test/instruments/constraint_range_notallowed.json: 'ValidationError: "text" Fields
      cannot have constraints: range'}
  - {test/instruments/constraint_record.json: VALIDATED}
  - {test/instruments/constraint_record_missing.json: 'ValidationError: "recordList"
      Field missing required options: record'}
  - {test/instruments/constraint_record_notallowed.json: 'ValidationError: "integer"
      Fields cannot have constraints: record'}
  - {test/instruments/empty_title.json: 'ValidationError: u'''' is too short'}
  - {test/instruments/identifiable.json: VALIDATED}
  - {test/instruments/matrix.json: VALIDATED}
  - {test/instruments/matrix_complex_column.json: 'ValidationError: Complex type "recordList"
      cannot be used within another complex type.'}
  - {test/instruments/missing_field.json: 'ValidationError: [] is too short'}
  - {test/instruments/missing_id.json: 'ValidationError: u''id'' is a required property'}
  - {test/instruments/missing_record.json: 'ValidationError: u''record'' is a required
      property'}
  - {test/instruments/missing_title.json: 'ValidationError: u''title'' is a required
      property'}
  - {test/instruments/missing_version.json: 'ValidationError: u''version'' is a required
      property'}
  - {test/instruments/multiple_questions.json: VALIDATED}
  - {test/instruments/not_an_object.json: 'ValidationError: Instrument Definitions
      must be mapped objects.'}
  - {test/instruments/recordlist.json: VALIDATED}
  - {test/instruments/recordlist_complex_field.json: 'ValidationError: Complex type
      "recordList" cannot be used within another complex type.'}
  - {test/instruments/repeated_id.json: 'ValidationError: ID "q_fake" is defined multiple
      times.'}
  - {test/instruments/repeated_id_matrix.json: 'ValidationError: There are generated
      matrix IDs that already exist as individal identifiers: qq_fake'}
  - {test/instruments/repeated_id_matrix_column.json: 'ValidationError: ID "q_fake"
      is defined multiple times.'}
  - {test/instruments/repeated_id_matrix_row.json: 'ValidationError: ID "q_fake" is
      defined multiple times.'}
  - {test/instruments/repeated_id_record.json: 'ValidationError: ID "q_fake" is defined
      multiple times.'}
  - {test/instruments/simplest.json: VALIDATED}
  - {test/instruments/types.json: VALIDATED}
  - {test/instruments/types_extend.json: VALIDATED}
  - {test/instruments/types_extend_complex.json: 'ValidationError: The "myCustomType"
      custom type cannot be based on complex type "recordList".'}
  - {test/instruments/types_extend_missing.json: 'ValidationError: "somethingMissing"
      does not exist as a type to inherit from.'}
  - {test/instruments/types_extend_missing_inline.json: 'ValidationError: "myOtherCustomType"
      does not exist as a type to inherit from.'}
  - {test/instruments/types_override.json: 'ValidationError: Additional properties
      are not allowed (u''text'' was unexpected)'}
- assessments: test/assessments/*.json
  validations:
  - {test/assessments/datatypes.json: VALIDATED}
  - {test/assessments/empty_values.json: 'ValidationError: {} does not have enough
      properties'}
  - {test/assessments/meta.json: VALIDATED}
  - {test/assessments/missing_instrument.json: 'ValidationError: u''instrument'' is
      a required property'}
  - {test/assessments/missing_instrument_id.json: 'ValidationError: u''id'' is a required
      property'}
  - {test/assessments/missing_instrument_version.json: 'ValidationError: u''version''
      is a required property'}
  - {test/assessments/missing_values.json: 'ValidationError: u''values'' is a required
      property'}
  - {test/assessments/not_an_object.json: 'ValidationError: Assessment Documents must
      be mapped objects.'}
  - {test/assessments/simplest.json: VALIDATED}
- suite: rex-instrument-validate
  tests:
  - sh: rex instrument-validate test/instruments/simplest.json
    stdout: |+
      "test/instruments/simplest.json" contains a valid Common Instrument Definition.

  - sh: rex instrument-validate test/instruments/missing_title.json
    stdout: |+
      FATAL ERROR: u'title' is a required property

  - sh: rex instrument-validate /tmp/does/not/actually/exist.json
    stdout: |+
      FATAL ERROR: Could not open "/tmp/does/not/actually/exist.json": [Errno 2] No such file or directory: '/tmp/does/not/actually/exist.json'

  - sh: rex instrument-validate
    stdout: |+
      FATAL ERROR: missing argument <definition>

- sh: pip uninstall -q -y rex.instrument_demo
  stdout: ''
