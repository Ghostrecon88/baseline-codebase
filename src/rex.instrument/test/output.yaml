#
# This file contains expected test output data generated by PBBT.
#
---
suite: rex.instrument
tests:
- sh: pip install -q -e ./demo/rex.instrument_demo
  stdout: ''
- instrumentversions: test/instruments
  validations:
  - {annotation.json: VALIDATED}
  - {annotation_bad.json: 'ValidationError: u''sure'' is not one of [u''required'',
      u''optional'', u''none'']'}
  - {annotation_required_mismatch.json: 'ValidationError: A field cannot both be required
      and allow annotations.'}
  - {bad_description.json: 'ValidationError: True is not of type u''string'''}
  - {bad_id.json: 'ValidationError: u''bad'' is not a u''uri'''}
  - {bad_question_id.json: 'ValidationError: u''Q--FAKE'' does not match u''^[a-z](?:[a-z0-9]|[_-](?![_-]))*[a-z0-9]$'''}
  - {bad_question_type.json: 'ValidationError: "foobar" is not a known field type.'}
  - {bad_version.json: 'ValidationError: u''bad'' does not match u''^[0-9]+\\.[0-9]+$'''}
  - {constraint_enumerations.json: VALIDATED}
  - {constraint_enumerations_missing.json: 'ValidationError: "enumeration" Field missing
      required options: enumerations'}
  - {constraint_enumerations_notallowed.json: 'ValidationError: "integer" Fields cannot
      have constraints: enumerations'}
  - {constraint_length.json: VALIDATED}
  - {constraint_length_notallowed.json: 'ValidationError: "integer" Fields cannot
      have constraints: length'}
  - {constraint_range.json: VALIDATED}
  - {constraint_range_bad.json: 'ValidationError: {u''range'': {u''min'': u''1''},
      u''base'': u''integer''} is not valid under any of the given schemas'}
  - {constraint_range_notallowed.json: 'ValidationError: "text" Fields cannot have
      constraints: range'}
  - {constraint_record.json: VALIDATED}
  - {constraint_record_missing.json: 'ValidationError: "recordList" Field missing
      required options: record'}
  - {constraint_record_notallowed.json: 'ValidationError: "integer" Fields cannot
      have constraints: record'}
  - {empty_title.json: 'ValidationError: u'''' is too short'}
  - {garbage.json: 'ValidationError: Invalid JSON provided: No JSON object could be
      decoded'}
  - {identifiable.json: VALIDATED}
  - {matrix.json: VALIDATED}
  - {matrix_complex_column.json: 'ValidationError: Complex type "recordList" cannot
      be used within another complex type.'}
  - {missing_field.json: 'ValidationError: [] is too short'}
  - {missing_id.json: 'ValidationError: u''id'' is a required property'}
  - {missing_record.json: 'ValidationError: u''record'' is a required property'}
  - {missing_title.json: 'ValidationError: u''title'' is a required property'}
  - {missing_version.json: 'ValidationError: u''version'' is a required property'}
  - {multiple_questions.json: VALIDATED}
  - {not_an_object.json: 'ValidationError: Instrument Definitions must be mapped objects.'}
  - {recordlist.json: VALIDATED}
  - {recordlist_complex_field.json: 'ValidationError: Complex type "recordList" cannot
      be used within another complex type.'}
  - {repeated_id.json: 'ValidationError: ID "q_fake" is defined multiple times.'}
  - {repeated_id_matrix.json: 'ValidationError: There are generated matrix IDs that
      already exist as individal identifiers: qq_fake'}
  - {repeated_id_matrix_column.json: 'ValidationError: ID "q_fake" is defined multiple
      times.'}
  - {repeated_id_matrix_row.json: 'ValidationError: ID "q_fake" is defined multiple
      times.'}
  - {repeated_id_record.json: 'ValidationError: ID "q_fake" is defined multiple times.'}
  - {simplest.json: VALIDATED}
  - {types.json: VALIDATED}
  - {types_extend.json: VALIDATED}
  - {types_extend_complex.json: 'ValidationError: The "myCustomType" custom type cannot
      be based on complex type "recordList".'}
  - {types_extend_missing.json: 'ValidationError: "somethingMissing" does not exist
      as a type to inherit from.'}
  - {types_extend_missing_inline.json: 'ValidationError: "myOtherCustomType" does
      not exist as a type to inherit from.'}
  - {types_override.json: 'ValidationError: Additional properties are not allowed
      (u''text'' was unexpected)'}
- assessments: test/assessments
  validations:
  - {all_types/bad_boolean.json: 'ValidationError: The value for "q_boolean" is not
      the correct type (boolean)'}
  - {all_types/bad_date.json: 'ValidationError: The value for "q_date" is not the
      correct type (date)'}
  - {all_types/bad_datetime.json: 'ValidationError: The value for "q_datetime" is
      not the correct type (dateTime)'}
  - {all_types/bad_enumeration.json: 'ValidationError: The value for "q_enumeration"
      is not the correct type (enumeration)'}
  - {all_types/bad_enumerationset.json: 'ValidationError: The value for "q_enumerationset"
      is not the correct type (enumerationSet)'}
  - {all_types/bad_enumerationset_element.json: 'ValidationError: [6, u''other'']
      is not valid under any of the given schemas'}
  - {all_types/bad_float.json: 'ValidationError: The value for "q_float" is not the
      correct type (float)'}
  - {all_types/bad_integer.json: 'ValidationError: The value for "q_integer" is not
      the correct type (integer)'}
  - {all_types/bad_recordlist.json: 'ValidationError: The value for "q_recordlist"
      is not the correct type (recordList)'}
  - {all_types/bad_recordlist_element.json: 'ValidationError: [{u''hello'': {u''value'':
      u''hi''}, u''goodbye'': {u''value'': u''see ya''}}, u''foo''] is not valid under
      any of the given schemas'}
  - {all_types/bad_recordlist_record.json: 'ValidationError: Assessment is missing
      values for: goodbye'}
  - {all_types/bad_text.json: 'ValidationError: The value for "q_text" is not the
      correct type (text)'}
  - {all_types/bad_time.json: 'ValidationError: The value for "q_time" is not the
      correct type (time)'}
  - {all_types/good.json: VALIDATED}
  - {all_types/nulls.json: VALIDATED}
  - {boolean/bad_missing_required.json: 'ValidationError: Assessment is missing values
      for: q_fake'}
  - {boolean/good.json: VALIDATED}
  - {boolean/good_with_false_required.json: VALIDATED}
  - {custom_type/good.json: VALIDATED}
  - {datatypes.json: VALIDATED}
  - {empty_values.json: 'ValidationError: {} does not have enough properties'}
  - {garbage/good.json: 'ValidationError: Invalid Instrument JSON provided: No JSON
      object could be decoded'}
  - {garbage.json: 'ValidationError: Invalid JSON provided: No JSON object could be
      decoded'}
  - {meta.json: VALIDATED}
  - {missing_instrument.json: 'ValidationError: u''instrument'' is a required property'}
  - {missing_instrument_id.json: 'ValidationError: u''id'' is a required property'}
  - {missing_instrument_version.json: 'ValidationError: u''version'' is a required
      property'}
  - {missing_values.json: 'ValidationError: u''values'' is a required property'}
  - {not_an_object/good.json: 'ValidationError: Instrument Definitions must be mapped
      objects.'}
  - {not_an_object.json: 'ValidationError: Assessment Documents must be mapped objects.'}
  - {simplest/bad_instrument_id.json: 'ValidationError: This Assessment is not associated
      with the specified Instrument Definition'}
  - {simplest/bad_instrument_version.json: 'ValidationError: This Assessment is not
      associated with the specified Instrument Definition'}
  - {simplest/good.json: VALIDATED}
  - {simplest.json: VALIDATED}
  - {small/extra_annotation.json: 'ValidationError: An annotation for field "q_bar"
      is not allowed'}
  - {small/extra_explanation.json: 'ValidationError: An explanation for field "q_fake"
      is not allowed'}
  - {small/extra_values.json: 'ValidationError: Assessment contains unexpected values:
      q_baz'}
  - {small/good.json: VALIDATED}
  - {small/missing_annotation.json: 'ValidationError: An annotation is required for
      field "q_fake"'}
  - {small/missing_explanation.json: 'ValidationError: An explanation is required
      for field "q_bar"'}
  - {small/missing_required.json: 'ValidationError: A value for field "q_bar" is required'}
  - {small/missing_values.json: 'ValidationError: Assessment is missing values for:
      q_foo, q_bar'}
  - {small/unnecessary_annotation.json: 'ValidationError: An annotation for field
      "q_foo" is not required because it has a value'}
- suite: rex-instrument-validate
  tests:
  - sh: rex instrument-validate test/instruments/simplest.json
    stdout: |+
      "test/instruments/simplest.json" contains a valid Common Instrument Definition.

  - sh: rex instrument-validate test/instruments/missing_title.json
    stdout: |+
      FATAL ERROR: u'title' is a required property

  - sh: rex instrument-validate /tmp/does/not/actually/exist.json
    stdout: |+
      FATAL ERROR: Could not open "/tmp/does/not/actually/exist.json": [Errno 2] No such file or directory: '/tmp/does/not/actually/exist.json'

  - sh: rex instrument-validate
    stdout: |+
      FATAL ERROR: missing argument <definition>

- sh: pip uninstall -q -y rex.instrument_demo
  stdout: ''
