platform: linux

image_resource:
  type: docker-image
  source:
    repository: rexdb/build
    tag: 2019.02.27

inputs:
- name: codebase

params:
  CI: "true"
  CONTINUOUS_INTEGRATION: "true"

run:
  path: /bin/sh
  args:
  - -exc
  - |
    apt-get update
    apt-get install --yes postgresql
    service postgresql start
    su - postgres -c 'createuser -s root'
    make init-local
    make test
  dir: codebase
